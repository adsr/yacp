--- origsrc/libsemigroups-1.1.0/Makefile.am	2020-05-28 20:51:56.000000000 +0900
+++ src/libsemigroups-1.1.0/Makefile.am	2020-05-29 14:33:44.244269200 +0900
@@ -8,8 +8,10 @@ AM_CXXFLAGS += -I$(abs_top_srcdir)/exter
 AM_CXXFLAGS += -std=gnu++11 -g -O3 -Wall -Wextra
 AM_CXXFLAGS += $(WARNING_CXXFLAGS)
 AM_CXXFLAGS += $(FMT_CFLAGS)
+AM_CXXFLAGS += -I$(top_builddir)/include
+AM_CXXFLAGS += -I$(top_builddir)/include/libsemigroups
 
-AM_LDFLAGS  =  -no-undefined -lpthread
+AM_LDFLAGS  =  -no-undefined
 
 if LIBSEMIGROUPS_DEBUG
 AM_CPPFLAGS = -DDEBUG
@@ -113,6 +115,7 @@ hpcombifallbackinclude_HEADERS =  extern
 hpcombifallbackinclude_HEADERS += extern/HPCombi/include/fallback/seq.hpp
 endif
 
+if !LIBSEMIGROUPS_FMT
 fmtincludedir = $(includedir)/libsemigroups/fmt
 fmtinclude_HEADERS =  extern/fmt-5.3.0/include/fmt/chrono.h  
 fmtinclude_HEADERS += extern/fmt-5.3.0/include/fmt/color.h  
@@ -125,6 +128,7 @@ fmtinclude_HEADERS += extern/fmt-5.3.0/i
 fmtinclude_HEADERS += extern/fmt-5.3.0/include/fmt/printf.h  
 fmtinclude_HEADERS += extern/fmt-5.3.0/include/fmt/ranges.h  
 fmtinclude_HEADERS += extern/fmt-5.3.0/include/fmt/time.h
+endif
 
 lib_LTLIBRARIES = libsemigroups.la
 
--- origsrc/libsemigroups-1.1.0/m4/ax_check_fmt.m4	2020-05-28 20:51:56.000000000 +0900
+++ src/libsemigroups-1.1.0/m4/ax_check_fmt.m4	2020-05-29 14:33:25.321345400 +0900
@@ -28,4 +28,5 @@ AC_DEFUN([AX_CHECK_FMT], [
 	AC_SUBST(FMT_CFLAGS, ['-I$(srcdir)/extern/fmt-5.3.0/include'])
         
   fi
+  AM_CONDITIONAL([LIBSEMIGROUPS_FMT], [test x"$with_external_fmt" = xyes])
 ])
